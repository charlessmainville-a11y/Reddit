<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Celeb Scroll ‚Äî Build v6.0</title>
<style>
  :root{
    --bg:#0c1116;--panel:#121820;--muted:#92a2b3;--text:#e9f1fb;
    --accent:#ff6aa6;--accent-2:#ffd54a;--good:#74f39a;--bad:#ff8e8e;
    --radius:20px;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:ui-sans-serif,system-ui,Segoe UI,Helvetica,Arial;
       background:radial-gradient(1200px 700px at 50% -200px,#1a2230 10%,#0c1116 60%),var(--bg);
       color:var(--text)}
  .wrap{max-width:820px;margin:28px auto;padding:0 16px 80px}
  header{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:14px}
  h1{font-size:24px;margin:0 10px 0 0;letter-spacing:.3px}
  .chip{background:#121820;border:1px solid #1e2835;color:#d8e6f9;
        padding:10px 14px;border-radius:14px;display:inline-flex;gap:10px;align-items:center}
  .pill{background:#1b2533;border:1px solid #253143;padding:12px 16px;border-radius:14px;
        display:inline-flex;gap:10px;align-items:center;color:#d6e2f5}
  .btn{background:var(--accent);color:#111;font-weight:800;border:none;padding:14px 18px;
       border-radius:14px;cursor:pointer;transition:.15s transform;box-shadow:0 6px 24px #ff6aa633}
  .btn:active{transform:translateY(1px) scale(.98)}
  .sub{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:10px 0 18px}
  .counter{min-width:76px;justify-content:center}
  .row{display:flex;gap:10px;flex-wrap:wrap;margin:8px 0 18px}
  .grid{display:grid;grid-template-columns:1fr;gap:18px}
  @media (min-width:640px){.grid{grid-template-columns:1fr 1fr}}
  .card{background:linear-gradient(#0f1621,#0b1119);
        border:1px solid #202b39;border-radius:var(--radius);overflow:hidden;
        box-shadow:0 16px 40px #0008}
  .frame{position:relative;background:#0a0f15;height:62vh;min-height:360px;display:flex;align-items:center;justify-content:center}
  .media{max-width:100%;max-height:100%;object-fit:contain;display:block}
  .meta{display:flex;justify-content:space-between;align-items:center;padding:10px 14px 14px}
  .tag{font-weight:700;color:#a9bbd4;background:#162132;border:1px solid #223044;border-radius:10px;padding:8px 12px}
  .actions{display:flex;gap:12px}
  .iconbtn{border:none;border-radius:12px;padding:12px 14px;font-weight:900;cursor:pointer}
  .like{background:var(--accent-2);color:#1b1b1b}
  .dislike{background:#263247;border:1px solid #2f3d52;color:#d1def5}
  .small{font-size:12px;color:var(--muted)}
  .hidden{display:none}
  dialog{background:#0e1520;border:1px solid #243246;color:var(--text);border-radius:16px;padding:14px 16px;max-width:640px;width:calc(100% - 24px)}
  dialog::backdrop{background:#0006}
  .footer{position:fixed;inset:auto 0 0 0;background:linear-gradient(180deg,#0000,#0008);
          color:#7f91a8;font-size:12px;text-align:center;padding:10px}
  a{color:#a9c9ff;text-decoration:none}
</style>
</head>
<body>
<div class="wrap">
  <header>
    <h1>Celeb Scroll</h1>
    <span class="chip">Build <strong>v6.0</strong></span>
    <button class="pill" id="btnHome">Home</button>
    <button class="pill" id="btnLiked">Liked ‚≠ê <span id="likedCount" class="small"></span></button>
    <button class="pill" id="btnTrouble">Troubleshoot ü©∫</button>
  </header>

  <div class="sub">
    <button class="btn" id="btnNew">New batch</button>
    <button class="btn" id="btnMore">Load more</button>
    <span class="pill counter"><span id="shown">0</span>/<span id="total">0</span></span>
  </div>

  <div id="modeHome" class="grid"></div>
  <div id="modeLiked" class="grid hidden"></div>

  <dialog id="diag">
    <div id="diagBody" style="white-space:pre-wrap; font-family:ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;"></div>
    <div style="text-align:right;margin-top:10px">
      <button class="btn" id="btnClose">Close</button>
    </div>
  </dialog>
</div>

<div class="footer">Source: <b>r/celebs</b> ‚Ä¢ images & gifs only ‚Ä¢ likes saved locally</div>

<script>
/* ========= CONFIG ========= */
const BUILD = "v6.0";
const BATCH_SIZE = 16;          // how many cards per batch
const LOAD_MORE_STEP = 8;       // add X more each time you press "Load more"
const SUBREDDIT = "celebs";     // we only pull from r/celebs
// 100 women ‚Äì actresses / models / influencers (adult)
const NAMES = [
 "Kendall Jenner","Charli D'Amelio","Lea Elui","Hailey Bieber","Madison Beer","Dua Lipa","Sabrina Carpenter","Gigi Hadid","Bella Hadid",
 "Sydney Sweeney","Alexandra Daddario","Ana de Armas","Margot Robbie","Emily Ratajkowski","Sommer Ray","Addison Rae","Olivia Rodrigo",
 "Jenna Ortega","Hailee Steinfeld","Selena Gomez","Ariana Grande","Taylor Swift","Zendaya","Florence Pugh","Emma Watson","Emma Stone",
 "Gal Gadot","Anya Taylor-Joy","Elizabeth Olsen","Brie Larson","Lily James","Jessica Alba","Kate Beckinsale","Emilia Clarke","Sophie Turner",
 "Barbara Palvin","Candice Swanepoel","Adriana Lima","Alessandra Ambrosio","Irina Shayk","Gigi Paris","Kaia Gerber","Karlie Kloss",
 "Cara Delevingne","Josephine Skriver","Elsa Hosk","Romee Strijd","Nina Agdal","Alexis Ren","Rachel Cook","Paige Spiranac","Sommer Ray",
 "Loren Gray","Lexi Rivera","Chantel Jeffries","Tana Mongeau","Amanda Cerny","Hannah Palmer","Ana Cheri","Natalie Roush","Julia Rose",
 "Sierra Skye","Abby Rao","Daisy Keech","Charly Jordan","Corinna Kopf","Valentina Fradegrada","Viki Odintcova","Natalia Barulich",
 "Lyna Perez","Katya Elise Henry","Demi Rose","India Reynolds","Veronika Rajek","Rachel Stuhlmann","Kylie Jenner","Kim Kardashian",
 "Kourtney Kardashian","Megan Fox","Blake Lively","Lili Reinhart","Camila Morrone","Kaya Scodelario","Millie Bobby Brown",
 "Alexis Texas","Emily Feld","Maude Apatow","Phoebe Dynevor","Madelyn Cline","Victoria Justice","Camila Cabello","Doja Cat",
 "Suki Waterhouse","Lucy Hale","Vanessa Hudgens","Eiza Gonz√°lez","Salma Hayek","Alexandra Shipp","Zo√´ Kravitz","Ana Ivanovic",
 "Iris Mittenaere","Lori Harvey"
];

/* ========= STATE ========= */
const state = {
  pool: [],        // all fetched items this batch
  shown: [],       // items currently rendered on Home
  liked: loadLiked(), // array of liked items
  log: [],
  busy:false
};
updateLikedCount();

/* ========= HELPERS ========= */
function logLine(msg){ state.log.unshift(`[${new Date().toLocaleTimeString()}] ${msg}`); }
function shuffle(a){ for(let i=a.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[a[i],a[j]]=[a[j],a[i]]} return a; }
function uniqBy(arr, key){ const seen=new Set(); return arr.filter(x=>!seen.has(key(x)) && seen.add(key(x))); }
function saveLiked(){ localStorage.setItem("liked_v6", JSON.stringify(state.liked)); updateLikedCount(); }
function loadLiked(){ try{ return JSON.parse(localStorage.getItem("liked_v6")||"[]"); }catch(e){return []} }
function updateLikedCount(){ const el=document.getElementById("likedCount"); if(!el) return; el.textContent = `(${state.liked.length})`; }

/* ========= REDDIT FETCH =========
   We only use r/celebs and search each name for image/gif posts.
   We avoid videos for reliability on GitHub Pages. */
async function searchCeleb(name, limit=20){
  const q = `${name} (url:.jpg OR url:.png OR url:.gif)`;
  const url = `https://www.reddit.com/r/${SUBREDDIT}/search.json?restrict_sr=1&sort=new&limit=${limit}&q=${encodeURIComponent(q)}&include_over_18=on&t=year`;
  try{
    const res = await fetch(url, {headers:{'Accept':'application/json'}});
    if(!res.ok) throw new Error(`${res.status} ${res.statusText}`);
    const data = await res.json();
    const items = (data.data?.children || []).map(c=>c.data).filter(p=>{
      const u=(p.url||"").toLowerCase();
      return (u.endsWith(".jpg")||u.endsWith(".jpeg")||u.endsWith(".png")||u.endsWith(".gif")) && !p.is_self;
    }).map(p=>({
      id:p.id,
      title:p.title,
      url:p.url,
      permalink:`https://reddit.com${p.permalink}`,
      sub:p.subreddit_name_prefixed,
      author:p.author,
      nsfw:!!p.over_18,
      nameTag:name
    }));
    logLine(`${name}: +${items.length}`);
    return items;
  }catch(err){
    logLine(`${name}: ${err.message||err}`);
    return [];
  }
}

/* ========= BUILD A BATCH ========= */
async function buildBatch(){
  if(state.busy) return;
  state.busy=true;
  state.pool = [];
  state.shown = [];
  document.getElementById("modeHome").innerHTML = "";
  setCounter(0,0);
  logLine("Building new batch‚Ä¶");
  const names = shuffle([...NAMES]);
  const chunkSize = 8; // hit reddit in gentle bursts
  for(let i=0;i<names.length;i+=chunkSize){
    const slice = names.slice(i,i+chunkSize);
    const results = await Promise.all(slice.map(n=>searchCeleb(n, 15)));
    const flat = results.flat();
    state.pool.push(...flat);
    state.pool = uniqBy(state.pool, x=>x.url);
    setCounter(0,state.pool.length);
    // show some early
    if(state.shown.length < BATCH_SIZE && state.pool.length){
      appendMore(Math.min(BATCH_SIZE - state.shown.length, state.pool.length));
    }
    await sleep(450); // be polite to reddit
  }
  if(!state.pool.length){
    toast("No fresh posts. Try New batch again.");
  }else{
    logLine(`Batch ready: ${state.pool.length} items`);
  }
  state.busy=false;
}
function sleep(ms){return new Promise(r=>setTimeout(r,ms));}

/* ========= RENDER ========= */
function makeCard(item){
  const card=document.createElement("div"); card.className="card";
  const frame=document.createElement("div"); frame.className="frame";
  const isGif=item.url.toLowerCase().endsWith(".gif");
  const media = document.createElement(isGif ? "img" : "img");
  media.className="media"; media.loading="lazy"; media.src=item.url; media.alt=item.title||"";
  frame.appendChild(media);
  const meta=document.createElement("div"); meta.className="meta";
  const tag=document.createElement("div"); tag.className="tag"; tag.textContent = item.nameTag || "Celebs";
  const actions=document.createElement("div"); actions.className="actions";
  const like=document.createElement("button"); like.className="iconbtn like"; like.textContent="‚≠ê";
  const dislike=document.createElement("button"); dislike.className="iconbtn dislike"; dislike.textContent="üëé";
  like.onclick=()=>handleLike(item, card);
  dislike.onclick=()=>handleDismiss(card);
  actions.append(like,dislike);
  meta.append(tag,actions);
  const footer=document.createElement("div");
  footer.style.display="flex"; footer.style.justifyContent="space-between";
  footer.style.alignItems="center"; footer.style.padding="0 14px 16px";
  const a=document.createElement("a"); a.href=item.permalink; a.target="_blank"; a.textContent="Reddit";
  const small=document.createElement("div"); small.className="small"; small.textContent=item.sub;
  footer.append(a,small);
  card.append(frame,meta,footer);
  return card;
}
function handleLike(item, card){
  // don't duplicate likes by URL
  if(!state.liked.some(x=>x.url===item.url)){ state.liked.unshift(item); saveLiked(); }
  card.remove(); updateShown(-1);
}
function handleDismiss(card){
  card.remove(); updateShown(-1);
}
function appendMore(n=LOAD_MORE_STEP){
  const container=document.getElementById("modeHome");
  const take = state.pool.splice(0,n);
  take.forEach(it=>{
    state.shown.push(it);
    container.appendChild(makeCard(it));
  });
  updateShown(+take.length);
}
function setCounter(a,b){ document.getElementById("shown").textContent=a; document.getElementById("total").textContent=b; }
function updateShown(delta){
  const shown = Math.max(0, Number(document.getElementById("shown").textContent)+delta);
  const total = state.pool.length + shown;
  setCounter(shown,total);
}

/* ========= LIKED VIEW ========= */
function renderLiked(){
  const box=document.getElementById("modeLiked");
  box.innerHTML="";
  if(!state.liked.length){ box.innerHTML = `<div class="small" style="padding:20px;">No likes yet.</div>`; return; }
  state.liked.forEach(item=>{
    const card=makeCard(item);
    // replace like with remove
    const btn=card.querySelector(".like");
    btn.textContent = "üóëÔ∏è";
    btn.onclick=()=>{
      state.liked = state.liked.filter(x=>x.url!==item.url);
      saveLiked(); card.remove();
    };
    box.appendChild(card);
  });
}

/* ========= UI / EVENTS ========= */
const btnHome=document.getElementById("btnHome");
const btnLiked=document.getElementById("btnLiked");
const btnTrouble=document.getElementById("btnTrouble");
const btnClose=document.getElementById("btnClose");
const btnNew=document.getElementById("btnNew");
const btnMore=document.getElementById("btnMore");
const diag=document.getElementById("diag");
const diagBody=document.getElementById("diagBody");

btnHome.onclick=()=>{ toggleMode("home"); };
btnLiked.onclick=()=>{ renderLiked(); toggleMode("liked"); };
btnTrouble.onclick=()=>{ showTrouble(); };
btnClose.onclick=()=>{ diag.close(); };
btnNew.onclick=()=>{ buildBatch(); };
btnMore.onclick=()=>{ if(!state.pool.length){ toast("Nothing else in this batch ‚Äî tap New batch."); return; } appendMore(); };

function toggleMode(which){
  document.getElementById("modeHome").classList.toggle("hidden", which!=="home");
  document.getElementById("modeLiked").classList.toggle("hidden", which!=="liked");
}
function showTrouble(){
  const lines = [
    `Build: ${BUILD}`,
    `Pool size: ${state.pool.length}, shown: ${state.shown.length}, likes: ${state.liked.length}`,
    ``,
    ...state.log.slice(0,24)
  ].join("\n");
  diagBody.textContent = lines;
  diag.showModal();
}
function toast(txt){
  const d=document.createElement("dialog");
  d.textContent = txt;
  d.style.background="#1a2230"; d.style.color="#fff"; d.style.border="1px solid #2a384b"; d.style.borderRadius="12px"; d.style.padding="10px 12px";
  document.body.appendChild(d); d.showModal(); setTimeout(()=>{d.close(); d.remove();},1600);
}

/* ========= KICKOFF ========= */
buildBatch();
</script>
</body>
</html>