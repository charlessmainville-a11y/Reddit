<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Celeb Scroll ‚Äî Build v6.2</title>
<style>
  :root{
    --bg: #eceff3;
    --card: #ffffff;
    --ink: #223;
    --muted:#6b7280;
    --accent:#ff7aa2;    /* pastel pink */
    --accent2:#8bd3dd;   /* pastel aqua */
    --accent3:#b7e4c7;   /* pastel mint */
    --shadow: 0 10px 30px rgba(0,0,0,.15);
    --radius: 22px;
  }
  /* Concrete-ish background: layered noise-like gradients */
  body{
    margin:0; color:var(--ink); background:
      radial-gradient(1200px 800px at -10% -20%, #f7f7f9 0%, #eceff3 70%) fixed,
      radial-gradient(900px 900px at 120% 20%, #fdfbff 0%, #eceff3 60%) fixed,
      radial-gradient(600px 600px at 40% 140%, #eef1f6 0%, #e8ebf1 70%) fixed;
    background-color:var(--bg);
    font-family: ui-rounded, system-ui, -apple-system, Segoe UI, Roboto, "Helvetica Neue", Arial, "Apple Color Emoji", "Segoe UI Emoji";
  }
  .wrap{max-width:840px;margin:18px auto 80px;padding:0 14px}
  header{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin-bottom:10px}
  .chip{border-radius:999px;padding:12px 18px;background:#fff;box-shadow:var(--shadow);font-weight:700}
  .chip.ghost{background:transparent;box-shadow:none;border:2px solid rgba(0,0,0,.08)}
  .right{margin-left:auto}
  .build{opacity:.6;font-weight:700}
  .panel{background:linear-gradient(180deg,#fff, #f8fafc);border-radius:28px;box-shadow:var(--shadow);padding:14px 14px 8px;margin:6px 0 16px}
  .controls{display:grid;grid-template-columns:1fr 1fr;gap:12px;align-items:center}
  button.btn{appearance:none;border:0;border-radius:18px;padding:14px 18px;font-weight:800;font-size:16px;cursor:pointer}
  .primary{background:var(--accent);color:#122}
  .subtle{background:#fff}
  .info{color:var(--muted);font-weight:700;margin:10px 6px 0}
  .counter{border:2px dashed rgba(0,0,0,.08);text-align:center;padding:14px 0;border-radius:18px;background:#fff;font-weight:800}
  .grid{display:grid;gap:18px}
  .card{
    background:var(--card);
    border-radius:var(--radius);
    box-shadow: var(--shadow);
    overflow:hidden;
    position:relative;
  }
  .media{display:block;width:100%;max-height:72vh;object-fit:cover;background:#e8edf3}
  .cardfoot{display:flex;gap:10px;align-items:center;justify-content:space-between;padding:12px 14px}
  .tag{background:linear-gradient(120deg,var(--accent2),var(--accent3));padding:10px 14px;border-radius:14px;font-weight:800;color:#123}
  .star,.nope{width:54px;height:54px;border-radius:14px;border:0;font-size:24px;font-weight:900;cursor:pointer;box-shadow:var(--shadow)}
  .star{background: #ffe089}
  .nope{background:#ffd1d1}
  .sub{color:var(--muted);font-weight:800}
  /* liked page */
  .viewbar{display:flex;gap:10px;margin:6px 0 12px}
  .hidden{display:none}
  /* troubleshoot modal */
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.5);display:none;align-items:flex-start;justify-content:center;padding:20px}
  .modal>div{max-width:860px;width:100%;background:#fff;border-radius:24px;box-shadow:var(--shadow);padding:14px}
  pre{white-space:pre-wrap;word-break:break-word;background:#f7f7fb;border-radius:14px;padding:12px;font-size:14px;color:#111}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <button class="chip ghost" id="homeBtn">Home</button>
      <button class="chip ghost" id="likedBtn">Liked ‚≠ê <span id="likedCount">0</span></button>
      <div class="chip right build">NSFW ok ‚Ä¢ people-only ‚Ä¢ Build v6.2</div>
    </header>

    <div class="panel">
      <div class="controls">
        <button class="btn subtle" id="newBatch">New batch</button>
        <button class="btn primary" id="loadMore">Load more</button>
        <div class="counter" id="counter">0/0</div>
        <button class="btn subtle" id="shuffleBtn">Shuffle üîÄ</button>
      </div>
      <div class="info" id="tip">Source: <b>r/celebs</b> ‚Ä¢ images/GIFs/video only ‚Ä¢ likes saved locally</div>
      <div class="viewbar">
        <button class="btn subtle" id="troubleshoot">Troubleshoot ü©∫</button>
      </div>
    </div>

    <section class="grid" id="feed"></section>

    <!-- Liked view -->
    <section class="grid hidden" id="likedView"></section>
  </div>

  <!-- Modal -->
  <div class="modal" id="modal"><div>
    <div style="display:flex;justify-content:space-between;align-items:center;gap:12px">
      <h3 style="margin:8px 0">Troubleshoot</h3>
      <button class="btn primary" id="closeModal">Close</button>
    </div>
    <pre id="log">loading‚Ä¶</pre>
  </div></div>

<script>
(() => {
  const BUILD = "v6.2";
  const feed = document.getElementById('feed');
  const likedView = document.getElementById('likedView');
  const counterEl = document.getElementById('counter');
  const likedCountEl = document.getElementById('likedCount');
  const tip = document.getElementById('tip');
  const logEl = document.getElementById('log');
  const modal = document.getElementById('modal');

  // ‚Äî‚Äî‚Äî Names (100) ‚Äî‚Äî‚Äî
  const NAMES = [
    "Charli D'Amelio","Lea Elui","Kendall Jenner","Hailey Bieber","Madison Beer","Addison Rae","Dua Lipa","Sabrina Carpenter","Sydney Sweeney","Alexandra Daddario",
    "Ana de Armas","Selena Gomez","Emily Ratajkowski","Bella Hadid","Gigi Hadid","Kaia Gerber","Sommer Ray","Barbara Palvin","Margot Robbie","Emma Watson",
    "Jenna Ortega","Zendaya","Anya Taylor-Joy","Ariana Grande","Taylor Swift","Megan Fox","Gal Gadot","Camila Cabello","Doja Cat","Olivia Rodrigo",
    "Kylie Jenner","Sofia Vergara","Salma Hayek","Emilia Clarke","Florence Pugh","Elizabeth Olsen","Alexandra Stan","Sara Sampaio","Rihanna","Keke Palmer",
    "Halsey","Iggy Azalea","Becky G","Vanessa Hudgens","Bella Thorne","Lily-Rose Depp","Joey King","Maisie Williams","Millie Bobby Brown","Hunter Schafer",
    "Lily Collins","Nina Dobrev","Candice Swanepoel","Irina Shayk","Rosie Huntington-Whiteley","Adriana Lima","Karlie Kloss","Natalie Portman","Aubrey Plaza","Ana de la Reguera",
    "Eva Green","Priyanka Chopra","Katherine Langford","Alexandra Shipp","Emma Stone","Dakota Johnson","Lucy Hale","Chlo√´ Grace Moretz","Hailee Steinfeld","Mia Khalifa",
    "Addison Timlin","Bella Poarch","Dixie D'Amelio","Chanel West Coast","Tana Mongeau","Loren Gray","Avril Lavigne","Noah Cyrus","Bebe Rexha","Madelyn Cline",
    "Lili Reinhart","Camila Mendes","Kiernan Shipka","Suki Waterhouse","Kaya Scodelario","Sophie Turner","Jodie Comer","Ana Cheri","Abby Rao","Veronika Rajek",
    "Emily Feld","Paige Spiranac","Alycia Debnam-Carey","Victoria Justice","Ava Max","Rachel Cook","Alexis Ren","Charli XCX","Ashlyn Rae","Chantel Jeffries"
  ];

  // State
  let pool = [];          // items ready to show
  let shown = 0;
  const likesKey = "celeb_scroll_likes_v1";
  let likes = JSON.parse(localStorage.getItem(likesKey) || "[]");

  // Helpers
  const logLines = [];
  const log = (s) => { logLines.unshift(`[${new Date().toLocaleTimeString()}] ${s}`); logEl.textContent =
    `Build: ${BUILD}\nPool size: ${pool.length}, shown: ${shown}, likes: ${likes.length}\n\n`+
    logLines.slice(0,40).join("\n"); };

  const updateCounters = () => {
    counterEl.textContent = `${shown}/${pool.length}`;
    likedCountEl.textContent = likes.length;
  };

  // Build a new batch from r/celebs search (no CORS proxy)
  async function buildBatch(batchSize=12){
    log("Building new batch‚Ä¶");
    pool = []; shown = 0; feed.innerHTML = "";
    const picks = shuffle([...NAMES]).slice(0, batchSize);
    for(const name of picks){
      try{
        const url = `https://www.reddit.com/r/celebs/search.json?q=${encodeURIComponent(name)}&restrict_sr=1&sort=new&t=month&limit=15`;
        const res = await fetch(url, {mode:'cors'});
        if(!res.ok) throw new Error(`HTTP ${res.status}`);
        const data = await res.json();
        const post = (data.data.children||[]).map(c=>c.data).find(p => isGoodMedia(p));
        if(post){
          const media = extractMedia(post);
          if(media){
            pool.push({
              id: post.id,
              title: name,
              subreddit: post.subreddit_name_prefixed || "r/celebs",
              media
            });
            log(`${name}: +1 (${media.type})`);
          }else{
            log(`${name}: no usable media`);
          }
        }else{
          log(`${name}: none with media`);
        }
        await sleep(250); // gentle pacing
      }catch(e){
        log(`${name}: ${e.message || e}`);
      }
      updateCounters();
    }
    if(pool.length===0) tip.textContent = "No fresh posts. Tap New batch again.";
    else tip.textContent = "Source: r/celebs ‚Ä¢ images/GIFs/video only ‚Ä¢ likes saved locally";
  }

  const isGoodMedia = (p)=>{
    if(p.over_18===false || p.over_18===true) {} // we accept both (risqu√© sprinkle later if you want)
    // gallery
    if(p.is_gallery && p.media_metadata) return true;
    // image
    if(p.post_hint === "image" && p.url_overridden_by_dest) return true;
    // gif via preview
    if(p.preview && p.preview.images?.[0]?.variants?.gif) return true;
    // reddit hosted video
    if(p.is_video && p.media?.reddit_video?.fallback_url) return true;
    return false;
  };

  const extractMedia = (p)=>{
    // gallery: pick the largest
    if(p.is_gallery && p.media_metadata){
      const first = Object.values(p.media_metadata)[0];
      if(first && first.s?.u) return {type:'image', src: htmlDecode(first.s.u)};
    }
    // image
    if(p.post_hint === "image" && p.url_overridden_by_dest){
      return {type:'image', src: p.url_overridden_by_dest};
    }
    // gif
    const gif = p.preview?.images?.[0]?.variants?.gif?.source?.url;
    if(gif) return {type:'gif', src: htmlDecode(gif)};
    // video
    const v = p.media?.reddit_video?.fallback_url;
    if(v) return {type:'video', src: v};
    return null;
  };

  function htmlDecode(u){ const d=document.createElement('textarea'); d.innerHTML=u; return d.value; }
  const sleep = (ms)=> new Promise(r=>setTimeout(r,ms));
  const shuffle = arr => arr.sort(()=>Math.random()-0.5);

  function renderCard(item){
    const card = document.createElement('article');
    card.className = "card";
    let mediaHTML = "";
    if(item.media.type==='image' || item.media.type==='gif'){
      mediaHTML = `<img class="media" loading="lazy" src="${item.media.src}" alt="">`;
    } else {
      mediaHTML = `<video class="media" playsinline muted autoplay loop controls src="${item.media.src}"></video>`;
    }
    card.innerHTML = `
      ${mediaHTML}
      <div class="cardfoot">
        <div class="tag">${item.title}</div>
        <div style="display:flex;gap:10px;align-items:center">
          <button class="star" title="Like">‚≠ê</button>
          <button class="nope" title="Dismiss">üëé</button>
        </div>
      </div>
      <div class="sub" style="padding:0 14px 14px">Reddit ‚Ä¢ ${item.subreddit}</div>
    `;
    const star = card.querySelector('.star');
    const nope = card.querySelector('.nope');
    star.onclick = () => {
      if(!likes.find(x=>x.id===item.id)){
        likes.unshift(item);
        localStorage.setItem(likesKey, JSON.stringify(likes.slice(0,300)));
        likedCountEl.textContent = likes.length;
        star.style.transform="scale(1.1)";
        star.style.transition="transform .12s";
        setTimeout(()=>star.style.transform="scale(1)",120);
      }
    };
    nope.onclick = () => {
      card.style.opacity=.6;
      card.style.transform="scale(.98)";
      setTimeout(()=>card.remove(),120);
    };
    feed.appendChild(card);
  }

  // UI actions
  document.getElementById('newBatch').onclick = async()=>{ await buildBatch(); updateCounters(); };
  document.getElementById('loadMore').onclick = ()=>{
    if(shown>=pool.length){ tip.textContent="No more in this batch."; return; }
    const next = pool[shown++]; renderCard(next); updateCounters();
  };
  document.getElementById('shuffleBtn').onclick = ()=>{
    pool = shuffle(pool); shown=0; feed.innerHTML=""; updateCounters(); tip.textContent="Shuffled. Tap Load more.";
  };
  document.getElementById('troubleshoot').onclick = ()=>{ modal.style.display='flex'; log("Opened troubleshoot."); updateCounters(); };
  document.getElementById('closeModal').onclick = ()=> modal.style.display='none';

  // Views
  document.getElementById('homeBtn').onclick = ()=>{
    likedView.classList.add('hidden'); feed.classList.remove('hidden');
  };
  document.getElementById('likedBtn').onclick = ()=>{
    likedView.innerHTML = "";
    likes.forEach(renderLiked);
    feed.classList.add('hidden'); likedView.classList.remove('hidden');
  };
  function renderLiked(item){
    const card = document.createElement('article');
    card.className="card";
    const src = item.media.src;
    const mediaHTML = item.media.type==='video'
      ? `<video class="media" playsinline muted loop controls src="${src}"></video>`
      : `<img class="media" src="${src}" alt="">`;
    card.innerHTML = `
      ${mediaHTML}
      <div class="cardfoot">
        <div class="tag">${item.title}</div>
        <button class="nope">üóëÔ∏è</button>
      </div>
      <div class="sub" style="padding:0 14px 14px">Saved from ${item.subreddit}</div>
    `;
    card.querySelector('.nope').onclick = ()=>{
      likes = likes.filter(x=>x.id!==item.id);
      localStorage.setItem(likesKey, JSON.stringify(likes));
      likedCountEl.textContent = likes.length;
      card.remove();
    };
    likedView.appendChild(card);
  }

  // Initial
  updateCounters(); likedCountEl.textContent = likes.length;
  // Kick off a small first batch automatically for quick feedback
  buildBatch(8);
})();
</script>
</body>
</html>